<?php

/* $Id$ */

require("mysql.inc.php");
require("common.inc.php");
require("ago_headers.inc.php");

$request = $PATH_INFO;
list($foo,$category,$background_num) = explode("/", $request);

/* print out the list of background categories */
if($category == "" || $category == "index.php")
{
	ago_header("BACKGROUNDS");
	create_middle_box_top("backgrounds");

	print("Backgrounds are images for use on your desktop as the desktop background, sometimes known as wallpapers.");
	
	print("<p>\n<table border=\"0\" cellpadding=\"4\">");
	reset($background_config_array);
	while(list($key,$val)=each($background_config_array))
	{
		$name = $val["name"];
		$url = $val["url"];
		$description = $val["description"];
		print("<tr><td valign=\"top\"><img src=\"/images/site/circle.png\"></td><td><a class=\"screenshot\" href=\"$url\">$name</a> - $description</td></tr>\n");
	}
	print("</table>\n");
	
	create_middle_box_bottom();
	ago_footer();
}

/* print out the background preview pages */
elseif( array_key_exists($category,$background_config_array) && ($background_num == "" || $background_num == "index.php"))
{
	ago_header("BACKGROUNDS - " . strtoupper($category));
	$temp = "backgrounds_" . $category;
   create_middle_box_top($temp);
	
	if(!$page)
	{
		$page = 1;
	}
	if(!$thumbnails_per_page || $thumbnails_per_page == 0 || $thumbnails_per_page == "")
	{
		$thumbnails_per_page = 12;
	}
	if(!$sort_by)
	{
		$sort_by = "date";
	}
	
	$background_select_all_result = mysql_query("SELECT * FROM background WHERE category='$category' AND status='active'AND parent='0' ORDER BY add_timestamp DESC");
	$num_backgrounds = mysql_num_rows($background_select_all_result);
	if($num_backgrounds == 0)
   {
   	print("No backgrounds have been added to this section yet.");
   }
   else
   {
		print_thumbnails_per_page_form($thumbnails_per_page, $sort_by, "Backgrounds");
	   print("<p>");
		list($page, $num_pages) = background_search_result("", "background", $category, $thumbnails_per_page, $sort_by, $page, $num_backgrounds);
		
		print("<div align=\"center\">\n");
		/* Page Navigation System */
		if($page > 1)
      {
      	$prev_page = $page -1;
         print(" <a href=\"$PHP_SELF?page=$prev_page&sort_by=$sort_by&thumbnails_per_page=$thumbnails_per_page\">[&lt;]</a>");
      }
		for($count=1;$count<=$num_pages;$count++)
		{
			if($count == $page)
   	   {
   	   	print("<span class=\"yellow-text\">[$count]</span> ");
			}
   	   else
   	   {
   	   	print("<a href=\"$PHP_SELF?page=$count&sort_by=$sort_by&thumbnails_per_page=$thumbnails_per_page\">[$count]</a> ");
   	   }
   	}
      if($page < $num_pages)
      {
      	$next_page = $page +1;
         print(" <a href=\"$PHP_SELF?page=$next_page&sort_by=$sort_by&thumbnails_per_page=$thumbnails_per_page\">[&gt;]</a>");
      }
      print("</div><p>\n");
	}
   
	create_middle_box_bottom();
	ago_footer();
}

/* print out the individual background page */
elseif( array_key_exists($category,$background_config_array) && $background_num != "")
{
	$backgroundID = ereg_replace(".php","",$background_num);
	
	$background_select_result = mysql_query("SELECT * FROM background WHERE backgroundID='$backgroundID'");
	if(mysql_num_rows($background_select_result)==0)
	{
   	ago_file_not_found();
	}
	else
	{
   	ago_header("BACKGROUNDS - " . strtoupper($category));
		$temp = "backgrounds_" . $category;
		create_middle_box_top($temp);
		$background_select_row = mysql_fetch_array($background_select_result);
   	$thumbnail_filename = $background_select_row["thumbnail_filename"];
   	$screenshot_filename = $background_select_row["screenshot_filename"];
   	$name = $background_select_row["background_name"];
   	$author = $background_select_row["author"];
   	$author_email = $background_select_row["author_email"];
   	$author_email = spam_proof_email($author_email);
   	$release_date = $background_select_row["release_date"];
   	list($year,$month,$day)=explode("-",$release_date);
   	$release_date = $month . "/" . $day . "/" . $year;
   	$background_description = $background_select_row["background_description"];
   	$screenshot_description = $background_select_row["screenshot_description"];
   	$background_resolution_select_result = mysql_query("SELECT type, resolution, filename FROM background_resolution WHERE backgroundID='$backgroundID' ORDER BY type,resolution");
   	print("<table border=\"0\">\n<tr><td valign=\"top\">");
   	print("<img src=\"/images/thumbnails/backgrounds/$thumbnail_filename\" class=\"shot2\">\n");
   	print("</td><td>\n");
   	print("<span class=\"yellow-text\">Name:</span> $name<br>\n<span class=\"yellow-text\">Author:</span> <a href=\"mailto:$author_email\">$author</a><br>\n<span class=\"yellow-text\">Release Date:</span> $release_date<br><span class=\"yellow-text\">Resolutions:</span>");
   	while(list($type,$resolution,$filename)=mysql_fetch_row($background_resolution_select_result))
   	{
      	if($current_type != $type)
      	{
         	print("<br>\n&nbsp;&nbsp;");
         	$current_type = $type;
      	}
      	else
      	{
      		print(" ;\n");
      	}
      	print("<a href=\"$mirror_url/backgrounds/$filename\">" . $type . "-" . $resolution . "</a>\n");
   	}
   	print("<br>\n");
   	if($screenshot_filename != "")
   	{
   		print("<a href=\"/images/screenshots/$screenshot_filename\" class=\"screenshot\">Screenshot</a><p>\n");
   	}
   	print("</td></tr></table>\n");
   	print("<p>\n<span class=\"yellow-text\">Info (Picture):</span> $background_description\n");
   	if($screenshot_description != "")
   	{
   		print("<p>\n<span class=\"yellow-text\">Info (Screenshot):</span> $screenshot_description\n");
   	}
   	$back_select_result = mysql_query("SELECT backgroundID,background_name,category FROM background WHERE parent='$backgroundID'");
   	if(mysql_num_rows($back_select_result)>0)
   	{
      	print("<p>\n<span class=\"yellow-text\">Variations:</span> ");
      	while(list($backID,$back_name,$back_cat)=mysql_fetch_row($back_select_result))
      	{
         	if($first_toggle)
         	{
            	print(" - ");
         	}
         	else
         	{
            	$first_toggle = 1;
         	}
         	print("<a href=\"/backgrounds/$back_cat/$backID.php\">$back_name</a>");
				
      	}
   	}
	create_middle_box_bottom();
	ago_footer();
	}
}
else
{
	ago_file_not_found();	
}

?>
